services:
  # FastAPI Backend Service with integrated crawler scheduler
  # Frontend is deployed separately on Vercel at https://amaniquery.vercel.app
  # Service name determines the URL: api-amaniquery -> https://api-amaniquery.onrender.com
  - name: api-amaniquery
    type: web
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: python start_api.py
    envVars:
      - key: CORS_ORIGINS
        value: https://amaniquery.vercel.app,https://www.amaniquery.vercel.app,http://localhost:3000,http://localhost:3001
      - key: API_HOST
        value: 0.0.0.0
      - key: API_RELOAD
        value: "false"
      - key: ENABLE_VOICE_AGENT
        value: "false"
      # Scheduler configuration
      - key: ENABLE_SCHEDULER
        value: "true"
      - key: SCHEDULER_BACKEND
        value: apscheduler
      # LLM configuration
      - key: LLM_PROVIDER
        value: moonshot
      - key: DEFAULT_MODEL
        value: moonshot-v1-8k
      - key: EMBEDDING_MODEL
        value: all-MiniLM-L6-v2
    plan: free
    # Render automatically assigns URL: https://api-amaniquery.onrender.com
    # based on the service name above
    # Uses start_api.py script which handles proper initialization and logging
    # Scheduler runs in background and triggers crawlers automatically